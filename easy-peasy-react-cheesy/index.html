<!doctype html><html xmlns=http://www.w3.org/1999/xhtml lang=en-us>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>Easy Peasy React Cheesy | Sweating the Small Stuff</title>
<meta property="og:title" content="Easy Peasy React Cheesy - Sweating the Small Stuff">
<meta property="og:description" content="Last week on twitter Dan Abramov was highlighting some of the easy ways to get your feet wet with React. I&rsquo;ve been playing with React for a while, and had heard the idea that one could add React as an individual component, or widget, to an already existing site. This looked like a good opportunity to try it out.
Caveat before we begin, the docs are great, there&rsquo;s nothing I&rsquo;m expanding here on what&rsquo;s already covered in the docs.">
<meta property="og:url" content="https://claytron5000.github.io/easy-peasy-react-cheesy/">
<meta property="og:site_name" content="Sweating the Small Stuff">
<meta property="og:type" content="article"><meta property="og:image" content="https://www.gravatar.com/avatar/b0aa23e34b24398a6de0b7868f0182c5?s=256"><meta property="article:section" content="Post"><meta property="article:published_time" content="2018-07-02T08:06:00Z"><meta property="article:modified_time" content="2018-07-02T08:06:00Z"><meta name=twitter:card content="summary"><meta name=twitter:site content="@ClaytonSalem"><meta name=twitter:creator content="@ClaytonSalem">
<link href=https://claytron5000.github.io/index.xml rel=alternate type=application/rss+xml title="Sweating the Small Stuff">
<link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://claytron5000.github.io/css/custom.css><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/site.webmanifest>
<link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5>
<link rel=canonical href=https://claytron5000.github.io/easy-peasy-react-cheesy/>
<meta name=msapplication-TileColor content="#da532c">
<meta name=theme-color content="#ffffff">
</head>
<body>
<section class=section>
<div class=container>
<nav id=nav-main class=nav>
<div id=nav-name class=nav-left>
<a id=nav-anchor class=nav-item href=https://claytron5000.github.io>
<h1 id=nav-heading class="title is-4">Sweating the Small Stuff</h1>
</a>
</div>
<div class=nav-right>
<nav id=nav-items class="nav-item level is-mobile"><a class=level-item aria-label=github href=https://github.com/claytron5000 target=_blank rel=noopener>
<span class=icon>
<i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></i>
</span>
</a><a class=level-item aria-label=twitter href=https://twitter.com/ClaytonSalem target=_blank rel=noopener>
<span class=icon>
<i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></i>
</span>
</a><a class=level-item aria-label=email href=mailto:claytonjsalem@gmail.com target=_blank rel=noopener>
<span class=icon>
<i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></i>
</span>
</a></nav>
</div>
</nav>
<nav class=nav>
</nav>
</div>
<script src=/js/navicon-shift.js></script>
</section>
<section class=section>
<div class=container>
<div class="subtitle tags is-6 is-pulled-right">
</div>
<h2 class="subtitle is-6">July 2, 2018</h2>
<h1 class=title>Easy Peasy React Cheesy</h1>
<div class=content>
<p>Last week on twitter <a href=https://twitter.com/dan_abramov/status/1011995700748521477>Dan Abramov</a> was highlighting some of the easy ways to get your feet wet with React. I&rsquo;ve been playing with React for a while, and had heard the idea that one could add React as an individual component, or widget, to an already existing site. This looked like a good opportunity to try it out.</p>
<p>Caveat before we begin, the docs are great, there&rsquo;s nothing I&rsquo;m expanding here on what&rsquo;s already covered in the docs. If you want to learn React, go read <a href=https://reactjs.org/docs/hello-world.html>the docs</a>.</p>
<h2 id=easy-incrementor>Easy Incrementor</h2>
<p><img src=/images/2018/counter1.gif alt="simple counter"></p>
<p>Oh, hi, you&rsquo;re still here. I&rsquo;m going to start with something close to the <a href=https://reactjs.org/docs/add-react-to-a-website.html>example</a>. Essentially, a small &ldquo;like&rdquo; button. However, I am upping the ante and instead of a simple, &ldquo;You liked it&rdquo;, we&rsquo;ll increment the &ldquo;likes&rdquo; on the button.</p>
<p>The beauty of this process is that we&rsquo;re including React libraries directly by <code>script</code> tag. No preprocessors, no webpack, we can even avoid <code>npm</code>.</p>
<blockquote>
<p>I was trying to decide if I should include my semi-controversial opinion about using CDN&rsquo;s, that is, don&rsquo;t use them, when I loaded the <code>unpkg</code> links in the site and&mldr; they were throwing 502 errors. So, here&rsquo;s my opinion: why trust a third party to always have the resources you need? Serve it yourself.</p>
</blockquote>
<p>But&mldr;. this is a demo project, and avoiding webpack, task runners, watchers&mldr; let do it! Here is a for real-life-already-existing website:</p>
<pre tabindex=0><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
&lt;meta charset=&quot;UTF-8&quot;&gt;
&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
&lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;
&lt;title&gt;For Real Website&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;A Real Website&lt;/h1&gt;
&lt;p&gt;With lot's of content, and other cool stuff.&lt;/p&gt;
&lt;div id=&quot;like_button_container&quot;&gt;&lt;/div&gt;
&lt;footer&gt;ouch, I stubbed my footer&lt;/footer&gt;
&lt;!-- Here's React! --&gt;
&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/react/16.4.1/umd/react.development.js&quot; crossorgin&gt;&lt;/script&gt;
&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/react-dom/16.4.1/umd/react-dom.development.js&quot; crossorgin&gt;&lt;/script&gt;
&lt;!-- and here's the code --&gt;
&lt;script src=&quot;./dist/like_button.js&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><p>First we&rsquo;re going to try React without JSX. I had some vague notion that JSX and React were different, but I haven&rsquo;t really considered one without the other. It turns out JSX looks a lot like a wrapper for <code>React.createElement</code>. <code>createElement</code> takes three arguments: the element type, the configuration (which in this case it going to be simply the click handler), and the element&rsquo;s children (in this case the button text).</p>
<p>Our LikeButton class.</p>
<p>In the constructor we&rsquo;ll set the counter to 0.</p>
<pre tabindex=0><code>constructor(props) {
  super(props);
  this.state = { counter: 0 };
}
</code></pre><p>Next the render, which sets the text for the button, and returns the <code>createElement</code>.</p>
<pre tabindex=0><code>  render() {
    let buttonText = 'Like'
    if (this.state.counter &gt; 0) {
      buttonText = 'Liked ' + this.state.counter + ' times';
    }
    return React.createElement( // createElement takes 3 arguments
      'button', // the element type
      { onClick: () =&gt; this.setState({ counter: this.state.counter + 1 }) }, // config
      buttonText // children, in this case text, but it could be another element.
    );
  }
</code></pre><p>Finally, we select the widget container and render in our LikeButton</p>
<h2 id=uping-the-game>Uping the Game</h2>
<p><img src=/images/2018/counter2.gif alt="squad goals"></p>
<p>I have some problems with this widget. First, it only goes up, thanks Facebook, and second, it&rsquo;s ephemeral and the values disappear as soon as the page is refreshed. I&rsquo;m going to up the game: add two button, increment and decrement (plus and minus to you plebians), and store the values in a database.</p>
<h3 id=add-jsx>Add JSX</h3>
<p>As simple as the <code>React.createElement</code> appears, once we start nesting elements it&rsquo;s going to get messier. I like JSX for the reason that it nests like HTML or XML. In the docs we&rsquo;re told, though not recommended, that we can add JSX support from the CDN&mldr; I guess that means it will compile the JSX on-the-fly. That seems a little nuts, so we&rsquo;re going to add a little compiler on the development side. You might compare this to compiling Sass. This part is covered in the docs, though my config ended up a bit different.</p>
<p>then <code>npx</code> will watch the source directory and output to the dist directory.</p>
<pre tabindex=0><code>npx babel --watch src --out-dir dist --presets react
</code></pre><p>Update the render, we&rsquo;re wrapping a div around two buttons and some text. If you run the following code through the <a href="https://babeljs.io/repl/#?babili=false&browsers=&build=&builtIns=false&spec=false&loose=false&code_lz=MYGwhgzhAEDCD2BXAdgFwKYCdroB4eQBMYAldMYVAOgQFsAHeZdNaAbwChppMXCsAFAEp2XbtBDpU0YElYBeaKgAWASwhUIqMBiqyUqANwcx3XqkSZk0AafEAeQqoBuAPjvjo9gEaJUqJmgmWBBVYABreTYBdBF5VyU1DWUwIkkQsPCBAEYhAF9XAGp7AHpffyZ3T082fTQ8jwdygOtg0IiomLiElXUqFLT0DIiBAQBaXPzXMYBIUubKxtKnNzshY24GvKA&debug=false&forceAllTransforms=false&shippedProposals=false&circleciRepo=&evaluate=false&fileSize=false&sourceType=module&lineWrap=true&presets=react&prettier=false&targets=&version=6.26.0&envVersion=">online babel compiler</a> you can start to see the connection between JSX and <code>React.createElement</code>.</p>
<pre tabindex=0><code>render() {
    let count = this.state.count;

    return (
      &lt;div&gt;
        &lt;button onClick={(e) =&gt; this.handleClick(1)}&gt;+&lt;/button&gt;
        {count}
        &lt;button onClick={(e) =&gt; this.handleClick((-1))}&gt;-&lt;/button&gt;
      &lt;/div&gt;
    );
  }
</code></pre><p>And in order to handle the click and update the state:</p>
<pre tabindex=0><code>handleClick(num) {
    let newCount = this.state.count != null ? this.state.count + num : 1;
    this.setState( { count: newCount } )
  }
</code></pre><p>I&rsquo;m working backward here, just to be confusing.</p>
<h3 id=firebase-it-up>Firebase it up!</h3>
<p>At this point I have a two button counter that works in one session on one page. Let&rsquo;s up the game with a firebase backend. To keep it simple I&rsquo;m setting the thing to open read-write, and basically it has one field, <code>count</code>. And to connect to said database I&rsquo;m using <code>fetch</code>. <a href="https://console.firebase.google.com/?pli=1">Firebase</a> is great, I&rsquo;m not going to explore it here, let&rsquo;s just look at it like a dummy endpoint.</p>
<p>My first try, I put it in</p>
<pre tabindex=0><code>componentDidMount() {
    fetch('https://myfirebasebackend')
      .then(res =&gt; res.json())
      .then(data =&gt; this.setState({ count: data }));
}
</code></pre><p>More about <a href=https://reactjs.org/docs/react-component.html#the-component-lifecycle>componentDidMount</a> and the lifecycle methods.</p>
<p>In the render I want to check if the count is set yet, if not, on first load, I&rsquo;m putting in a placeholder.</p>
<pre tabindex=0><code>let count = this.state.count != null ? &lt;span&gt;{this.state.count}&lt;/span&gt; : &lt;span&gt;_&lt;/span&gt;;
</code></pre><p>Next, update the click handler to update the database with a new value.</p>
<pre tabindex=0><code>handleClick(num) {
    let newCount = this.state.count != null ? parseInt(this.state.count) + num : 1;
    this.setState( { count: newCount } )
    fetch('https://myfirebasebackend', {method: 'PUT', body: JSON.stringify(newCount)})
  }
</code></pre><p>And, yes, I&rsquo;m doing two things at once in a function. How non-functional of me! Seriously, though, this <em>feels</em> wrong, if you know a better, or more functional way to do this, let me know.</p>
<p>We&rsquo;re close, but the value from one browser won&rsquo;t update in another browser, we need to get data from the database in real time. In this case, every second I&rsquo;ll fetch data. First move the fetch <code>GET</code> into a function:</p>
<pre tabindex=0><code>tick() {
    fetch(COUNTERAPI)
    .then(res =&gt; res.json())
    .then(data =&gt; this.setState({ count: data }));
  }
</code></pre><p>Then call the tick through <code>setInterval</code> from within <code>componentDidMount</code>, and clear it in <code>componentWillUnmount</code>:</p>
<pre tabindex=0><code>componentDidMount() {
    this.timerID = setInterval(() =&gt; this.tick(), 1000);
  }

  componentWillUnmount() {
    clearInterval(this.timerID);
  }
</code></pre><p>And&mldr; I think that&rsquo;s about it. I may have missed a couple things, so here&rsquo;s the whole shebang:</p>
<pre tabindex=0><code>'use strict';

const COUNTERAPI = 'https://myfirebasebackend'
class Counter extends React.Component {
  constructor(props) {
    super(props);

    this.state = {};
    this.handleClick = this.handleClick.bind(this);
  }

  componentDidMount() {
    this.timerID = setInterval(() =&gt; this.tick(), 1000);
  }

  componentWillUnmount() {
    clearInterval(this.timerID);
  }

  tick() {
    fetch(COUNTERAPI).then(res =&gt; res.json()).then(data =&gt; this.setState({ count: data }));
  }

  handleClick(num) {
    let newCount = this.state.count != null ? parseInt(this.state.count) + num : 1;
    this.setState( { count: newCount } )
    fetch(COUNTERAPI, {method: 'PUT', body: JSON.stringify(newCount)})
  }

  render() {
    let count = this.state.count != null ? {this.state.count} : '_';

    return (
      &lt;div&gt;
        &lt;button onClick={(e) =&gt; this.handleClick(1)}&gt;+&lt;/button&gt;
        {count}
        &lt;button onClick={(e) =&gt; this.handleClick((-1))}&gt;-&lt;/button&gt;
      &lt;/div&gt;
    );
  }
}

let domContainer = document.querySelector('#like_button_container');
ReactDOM.render(&lt;Counter /&gt;, domContainer);
</code></pre><p>Thanks, dear reader, if you got this far. The question I set out to answer was, is it easy to add React to an existing site? I think the answer is, yes, it is. But if you want to do anything more complicated than a simple counter, you&rsquo;ll probably want to add JSX, and the compiler. While it&rsquo;s nice that I can compile JSX with relative ease. I think the actual use-case for this in production is pretty limited. After all, I think most JavaScript developers could implement a simple counter without the excess weight of the React libraries. Maybe if I wanted to add a very complicated widget to an existing site, or a situation where I want to slowly transition a site from server-render to client site render.</p>
<p>And this leaves un-expolored the actual challenging part of a real website, which will have some Javascript functionality already in place, probably jQuery. Keeping those the jQuery seperate from React would be a whole other interesting challenge.</p>
<p>What this process <em>is</em> great for is learning. Getting up and running in react in just a few minutes is a real pleasure. And it was fun to write some &ldquo;plain React&rdquo; without JSX.</p>
<div class=related>
</div>
</div>
</div>
</section>
<script src=/js/copycode.js></script>
<section class=section>
<div class="container has-text-centered">
<p>&copy; <a href=https://github.com/claytron5000>Clayton Salem</a> 2021</p>
</div>
</section>
</body>
</html>